# Webアプリ（Javaの）の仕組み

実際の作業に入る前に、Javaで動作するWebアプリがどうやって動いているのかを
とっても簡単に説明します。  
つい先日勉強した内容をつらつらと書いているだけなので、
玄人の方々は、ここはすっ飛ばして作業に入ってください。


## TomcatとサーブレットとJSP

以下の図は、とっても簡単にWebアプリの構成を示します。

図


(上図①) クライアント（Webブラウザ）はサーバのURLにアクセスします。  
(上図②) サーバで常に起動しているTomcatが、URLにマッピングされているサーブレットを呼び出します。  
(上図③) 呼び出されたサーブレットでは、何らかの処理を行い、その処理結果をJSPに渡します。  
(上図④) JSPでは渡された処理結果を反映したHTMLを生成し、生成したHTMLをクライアントに返します。  
(上図⑤) クライアントで、返ってきたHTMLを表示します。  

（ Tomcat？ サーブレット？？ JSP？？？ ）  
訳の分からない単語がたくさん出てくる説明で申し訳ない。  
それぞれについてはすぐあとに説明があるので、とりあえず今はこの図の構成をぼーっと眺めて、  
あーこうなってるのねーふんふん、と分かった気になってください。

ただHTMLを表示するだけなのに、なんでこんなに複雑なことをしているのか。  
それはたいていのWebアプリでは、HTMLを動的に生成する必要があるからです。
例えば、ユーザのTwitterタイムラインを表示するWebアプリの場合、ユーザIDとパスワードから、各ユーザごとに異なるHTMLのページを生成しなければなりませんね。  
もし、どのページでも全ユーザに全く同じHTMLを見せればいいのなら、こうした枠組みはほとんど必要ないものになります。（これをWebアプリと呼んでいいのか）

それではここから、Tomcat、サーブレット、JSPの簡単な説明をして、最後にもう一度全体像を復習します。  
もう読み疲れた人はここを飛ばして、作業に入ってくれていいんだよ！（泣）


###Tomcat兄さん

Tomcat兄さんはサーバ上で常に起動しています。このTomcat兄さんは、サーブレットコンテナと呼ばれていて、クライアントからのリクエストを受け取って、実行すべきサーブレットのプログラムを探してきて、そのプログラムを実行します。  
（兄さんはゴロが良いので付けてるだけです。気にせずバンバン進みましょう。）


###サーブレット

サーブレットは、「サーバ上で動作するJavaプログラム」という説明が一般的です。
なんともグッとこない説明ですが、ここで言いたいことは、「サーブレットはmain関数を持たない」ということなんです。  
一般のJavaプログラムを実行すると、まずmain関数を実行します。そして、そのmain関数の中で様々な関数を実行していく形をとります。  
それに対して、サーブレットにはmain関数がなく、サーブレット中に記述された関数にはURLがマッピングされています。このURLにクライアントからアクセスがあると、アクセスを受け取ったTomcat兄さんが、マッピングされているサーブレットの関数を呼び出して実行することで、プログラムが実行されます。  
なので、一般的なJavaプログラムと違い、「サーバ上でTomcat兄さんに指定されて動作するJavaプログラム」という説明になります。



###JSP(Java Server Pages)





----
実際のシステムでは、大量のアクセスや長期運用に対処できるように、もっと複雑な構成になっています（サーバの分割やMVCモデルの導入など）が、基本的な構成は上図のようになっています。
