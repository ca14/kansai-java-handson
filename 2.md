# Webアプリケーションの仕組み

実際の作業に入る前に、Webアプリケーションがどうやって動いているのかを
とっても簡単に説明します。  
つい先日勉強した内容をつらつらと書いているだけなので、
玄人の方々は、ここはすっ飛ばして作業に入ってください。


## TomcatとサーブレットとJSP

以下の図は、とっても簡単にWebアプリの構成を示します。

図


まず、クライアント（Webブラウザ）はサーバのURLにアクセスします。（上図①）  
すると、サーバで常に起動しているTomcatがURLにマッピングされているサーブレットを呼び出します。（上図②）  
呼び出されたサーブレットでは、何らかの処理（DBから情報を取得するなど）を行い、その処理結果をJSPに渡します。(上図③)  
JSPでは渡された処理結果を反映したHTMLを生成し、生成したHTMLをクライアントに返します。（上図④）
最後に、返ってきたHTMLクライアントで表示します。（上図⑤）

（ Tomcat？ サーブレット？？ JSP？？？ ）  
訳の分からない単語がたくさん出てくる説明で申し訳ない。  
それぞれについてはすぐあとに説明があるので、とりあえず今はこの図の構成をぼーっと眺めて、あーこうなってるのねーふんふん、と分かった気になってください。

ただHTMLを表示するだけなのに、なんでこんなに複雑なことをしているのか。  
それはたいていのWebアプリでは、HTMLを動的に生成する必要があるからです。
例えば、ユーザのTwitterタイムラインを表示するWebアプリの場合、ユーザIDとパスワードから、各ユーザごとに異なるHTMLのページを生成しなければなりませんね。  
もし、どのページでも全ユーザに全く同じHTMLを見せればいいのなら、こうした枠組みはほとんど必要ないものになります。（これをWebアプリと呼んでいいのか）

それではここから、Tomcat、サーブレット、JSPの簡単な説明をします。
もう読み疲れた人はここを飛ばして、作業に入ってくれていいんだよ！（泣）


###Tomcat兄さん

Tomcat兄さんはサーバ上で常に起動しています。このTomcat兄さんがクライアントからのアクセスを受け取って、実行すべきプログラムを探してきて、そのプログラムを実行します。

###サーブレット

サーブレットは、「サーバ上で動作するJavaプログラム」という説明が一般的です。
なぜこのような言い方をするかというと、サーブレットはmain関数を持たないからです。  
一般のJavaプログラムは、まずmain関数を実行することでプログラムが動きます。そのmain関数の中で様々な関数を実行していく形をとります。  
それに対して、サーブレットにはmain関数がなく、サーブレット中に記述された関数にはURLがマッピングされています。このURLにクライアントからアクセスがあると、アクセスを受け取ったTomcat兄さんが、マッピングされているサーブレットの関数を呼び出すことで、プログラムが実行されます。

###JSP(Java Server Pages)




実際のシステムでは、大量のアクセスや長期運用に対処できるように、もっと複雑な構成になっています（サーバの分割やMVCモデルの導入など）が、基本的な構成は上図のようになっています。
